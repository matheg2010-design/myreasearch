<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الأدوات الإحصائية - بحثي</title>
    <meta name="description" content="أدوات إحصائية أكاديمية آمنة وموثوقة لتحليل البيانات البحثية">
    
    <!-- أذونات الأمان -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://unpkg.com https://cdnjs.cloudflare.com; style-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; connect-src 'self'">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Load our CSS -->
    <link rel="stylesheet" href="css/statistics.css">
    
    <!-- Load external libraries -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.6/dist/jstat.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-statistics@7.8.3/dist/simple-statistics.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" role="navigation" aria-label="القائمة الرئيسية">
        <div class="container">
            <a class="navbar-brand arabic-heading" href="index.html" aria-label="الرئيسية - منصة بحثي">
                بحثي
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="تبديل التنقل">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html" aria-current="page">الرئيسية</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="research-guide.html">الإرشادات</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="statistics.html">الإحصاء</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="support.html">الدعم</a>
                    </li>
                </ul>
                <a href="support.html" class="cta-button" role="button" aria-label="طلب استشارة إحصائية">
                    اطلع استشارة
                </a>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <header class="page-header" role="banner">
        <div class="container">
            <h1 class="arabic-heading" id="main-title">الأدوات الإحصائية المتقدمة</h1>
            <p class="lead" id="page-description">
                نظام تحليل إحصائي أكاديمي آمن - تحليل بياناتك بدقة ومعالجة متقدمة
            </p>
        </div>
    </header>

    <!-- Data Upload Section -->
    <section class="data-upload-section" aria-labelledby="upload-title">
        <div class="container">
            <h2 class="arabic-heading text-center mb-4" id="upload-title">تحميل البيانات</h2>
            
            <div class="upload-container">
                <!-- File Upload -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="data-file" class="form-label">
                                <i class="fas fa-file-upload me-2"></i>تحميل ملف بيانات
                            </label>
                            <input type="file" class="form-control" id="data-file" 
                                   accept=".csv,.txt,.tsv" aria-describedby="fileHelp">
                            <div id="fileHelp" class="form-text">
                                الملفات المسموحة: CSV, TSV, TXT (الحد الأقصى: 10 ميجابايت)
                            </div>
                        </div>
                        
                        <div class="alert alert-info d-none" id="file-validation" role="alert">
                            <i class="fas fa-spinner fa-spin me-2"></i>جاري التحقق من الملف...
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="manual-data" class="form-label">
                                <i class="fas fa-keyboard me-2"></i>إدخال يدوي
                            </label>
                            <textarea class="form-control" id="manual-data" rows="4"
                                      placeholder="المجموعة,الدرجة
تجريبية,85
تجريبية,78
ضابطة,72
ضابطة,68"
                                      aria-describedby="manualHelp"></textarea>
                            <div id="manualHelp" class="form-text">
                                أدخل البيانات بصيغة CSV مع رأس للأعمدة
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Control Buttons -->
                <div class="row mb-4">
                    <div class="col-md-4 mb-2">
                        <button type="button" class="btn btn-warning w-100" id="load-sample-btn"
                                aria-label="تحميل بيانات تجريبية">
                            <i class="fas fa-database me-2"></i>بيانات تجريبية
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button type="button" class="btn btn-primary w-100" id="process-data-btn"
                                aria-label="معالجة البيانات المدخلة">
                            <i class="fas fa-check me-2"></i>معالجة البيانات
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button type="button" class="btn btn-outline-secondary w-100" id="clear-data-btn"
                                aria-label="مسح البيانات الحالية">
                            <i class="fas fa-trash me-2"></i>مسح البيانات
                        </button>
                    </div>
                </div>
                
                <!-- Column Selection -->
                <div class="row mb-4 d-none" id="column-selection-section">
                    <div class="col-md-6 mb-3">
                        <label for="categorical-column" class="form-label">
                            <i class="fas fa-tags me-2"></i>العمود الفئوي (المجموعات)
                        </label>
                        <select class="form-select" id="categorical-column" aria-label="اختر عمود المجموعات">
                            <option value="">اختر عمود المجموعات</option>
                        </select>
                        <div class="form-text">يحتوي على فئات أو مجموعات للمقارنة</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="numerical-column" class="form-label">
                            <i class="fas fa-chart-line me-2"></i>العمود العددي (القيم)
                        </label>
                        <select class="form-select" id="numerical-column" aria-label="اختر عمود القيم">
                            <option value="">اختر عمود القيم</option>
                        </select>
                        <div class="form-text">يحتوي على قيم رقمية للتحليل</div>
                    </div>
                </div>
                
                <!-- Data Preview -->
                <div class="data-preview d-none" id="data-preview-section" role="region" aria-labelledby="preview-title">
                    <h5 id="preview-title" class="mb-3">
                        <i class="fas fa-table me-2"></i>معاينة البيانات
                    </h5>
                    <div class="table-responsive">
                        <table class="data-table" id="data-table" role="grid" aria-label="جدول معاينة البيانات">
                            <!-- Data will be populated here -->
                        </table>
                    </div>
                </div>
                
                <!-- Data Statistics -->
                <div class="row mt-4 d-none" id="data-stats-section">
                    <div class="col-md-3 col-6">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-list-ol"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">عدد الصفوف</div>
                                <div class="stat-value" id="row-count">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-columns"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">عدد الأعمدة</div>
                                <div class="stat-value" id="col-count">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">نوع البيانات</div>
                                <div class="stat-value" id="data-type">-</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">جاهزية</div>
                                <div class="stat-value" id="data-status">❌</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Validation Results -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="validation-results d-none" id="validation-results" role="alert">
                            <!-- Validation messages will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Statistical Wizard -->
    <section class="wizard-section" aria-labelledby="wizard-title">
        <div class="container">
            <h2 class="arabic-heading text-center mb-4" id="wizard-title">معالج الاختبار الإحصائي</h2>
            
            <div class="wizard-container">
                <div class="progress-container">
                    <div class="progress" role="progressbar" aria-label="تقدم المعالج"
                         aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-bar" style="width: 25%"></div>
                    </div>
                    <div class="progress-text" id="progress-text">الخطوة 1 من 5</div>
                </div>
                
                <!-- Step 1: Research Design -->
                <div class="wizard-step active" id="step-1" role="tabpanel" aria-labelledby="step-1-title">
                    <h3 id="step-1-title" class="step-title arabic-heading">تصميم الدراسة</h3>
                    <div class="options-container">
                        <button class="option-card" data-value="comparison" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <h5>مقارنة المجموعات</h5>
                            <p>مقارنة بين مجموعتين أو أكثر</p>
                        </button>
                        <button class="option-card" data-value="association" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <h5>دراسة العلاقات</h5>
                            <p>دراسة الارتباط بين متغيرات</p>
                        </button>
                        <button class="option-card" data-value="prediction" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h5>النمذجة والتنبؤ</h5>
                            <p>بناء نماذج للتنبؤ والتفسير</p>
                        </button>
                    </div>
                </div>
                
                <!-- Step 2: Data Characteristics -->
                <div class="wizard-step" id="step-2" role="tabpanel" aria-labelledby="step-2-title">
                    <h3 id="step-2-title" class="step-title arabic-heading">خصائص البيانات</h3>
                    <div class="options-container">
                        <button class="option-card" data-value="continuous-normal" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <h5>كمية + توزيع طبيعي</h5>
                            <p>بيانات كمية موزعة طبيعياً</p>
                        </button>
                        <button class="option-card" data-value="continuous-nonnormal" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-chart-area"></i>
                            </div>
                            <h5>كمية + غير طبيعي</h5>
                            <p>بيانات كمية غير موزعة طبيعياً</p>
                        </button>
                        <button class="option-card" data-value="categorical" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-tags"></i>
                            </div>
                            <h5>بيانات فئوية</h5>
                            <p>تصنيفات أو فئات</p>
                        </button>
                        <button class="option-card" data-value="ordinal" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-sort-amount-up"></i>
                            </div>
                            <h5>بيانات ترتيبية</h5>
                            <p>رتب أو مستويات</p>
                        </button>
                    </div>
                </div>
                
                <!-- Step 3: Sample Details -->
                <div class="wizard-step" id="step-3" role="tabpanel" aria-labelledby="step-3-title">
                    <h3 id="step-3-title" class="step-title arabic-heading">تفاصيل العينة</h3>
                    <div class="options-container">
                        <button class="option-card" data-value="independent" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-user-friends"></i>
                            </div>
                            <h5>عينات مستقلة</h5>
                            <p>مشاهدات غير مرتبطة</p>
                        </button>
                        <button class="option-card" data-value="paired" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-retweet"></i>
                            </div>
                            <h5>عينات مترابطة</h5>
                            <p>قياسات متكررة لنفس الأفراد</p>
                        </button>
                        <button class="option-card" data-value="mixed" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-layer-group"></i>
                            </div>
                            <h5>تصميم مختلط</h5>
                            <p>مزيج من العينات</p>
                        </button>
                    </div>
                </div>
                
                <!-- Step 4: Group Count -->
                <div class="wizard-step" id="step-4" role="tabpanel" aria-labelledby="step-4-title">
                    <h3 id="step-4-title" class="step-title arabic-heading">عدد المجموعات</h3>
                    <div class="options-container">
                        <button class="option-card" data-value="2" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-balance-scale-left"></i>
                            </div>
                            <h5>مجموعتان</h5>
                            <p>مقارنة مباشرة</p>
                        </button>
                        <button class="option-card" data-value="3+" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h5>ثلاث مجموعات أو أكثر</h5>
                            <p>مقارنة متعددة</p>
                        </button>
                        <button class="option-card" data-value="variable" role="radio" aria-checked="false">
                            <div class="option-icon">
                                <i class="fas fa-sliders-h"></i>
                            </div>
                            <h5>متغيرات مستمرة</h5>
                            <p>علاقات غير محددة بعدد</p>
                        </button>
                    </div>
                </div>
                
                <!-- Step 5: Assumption Check -->
                <div class="wizard-step" id="step-5" role="tabpanel" aria-labelledby="step-5-title">
                    <h3 id="step-5-title" class="step-title arabic-heading">فحص الافتراضات</h3>
                    <div class="assumption-check">
                        <div class="mb-4">
                            <h5 class="arabic-heading mb-3">اختر الاختبارات التحضيرية:</h5>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="check-normality" checked>
                                <label class="form-check-label" for="check-normality">
                                    فحص التوزيع الطبيعي (Shapiro-Wilk)
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="check-homogeneity" checked>
                                <label class="form-check-label" for="check-homogeneity">
                                    فحص تجانس التباين (Levene's test)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="check-outliers">
                                <label class="form-check-label" for="check-outliers">
                                    فحص القيم المتطرفة
                                </label>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary w-100" id="run-assumptions-btn">
                            <i class="fas fa-search me-2"></i>فحص الافتراضات الآن
                        </button>
                        
                        <div class="assumption-results mt-3 d-none" id="assumption-results">
                            <!-- Assumption check results will appear here -->
                        </div>
                    </div>
                </div>
                
                <!-- Navigation -->
                <div class="wizard-navigation mt-4">
                    <button class="btn btn-secondary" id="prev-btn" aria-label="الخطوة السابقة">
                        <i class="fas fa-arrow-right me-2"></i>السابق
                    </button>
                    <div class="step-indicators">
                        <span class="step-indicator active" data-step="1" aria-label="الخطوة 1"></span>
                        <span class="step-indicator" data-step="2" aria-label="الخطوة 2"></span>
                        <span class="step-indicator" data-step="3" aria-label="الخطوة 3"></span>
                        <span class="step-indicator" data-step="4" aria-label="الخطوة 4"></span>
                        <span class="step-indicator" data-step="5" aria-label="الخطوة 5"></span>
                    </div>
                    <button class="btn btn-warning" id="next-btn" aria-label="الخطوة التالية">
                        التالي<i class="fas fa-arrow-left ms-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Test Recommendations -->
    <section class="recommendations-section d-none" aria-labelledby="recommendations-title">
        <div class="container">
            <h2 class="arabic-heading text-center mb-4" id="recommendations-title">التوصيات الإحصائية</h2>
            
            <div class="recommendations-container">
                <div class="recommendation-header">
                    <h4 class="arabic-heading">الاختبارات الموصى بها</h4>
                    <button class="btn btn-outline-primary" id="compare-tests-btn">
                        <i class="fas fa-exchange-alt me-2"></i>مقارنة الاختبارات
                    </button>
                </div>
                
                <div class="recommendations-grid" id="recommendations-grid">
                    <!-- Test recommendations will be populated here -->
                </div>
                
                <div class="text-center mt-4">
                    <button class="btn btn-success btn-lg" id="run-analysis-btn">
                        <i class="fas fa-play-circle me-2"></i>تشغيل التحليل الموصى به
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Analysis Results -->
    <section class="results-section d-none" aria-labelledby="results-title">
        <div class="container">
            <h2 class="arabic-heading text-center mb-4" id="results-title">نتائج التحليل</h2>
            
            <div class="results-container">
                <!-- Results will be populated here -->
            </div>
        </div>
    </section>

    <!-- Test Database -->
    <section class="test-database" aria-labelledby="database-title">
        <div class="container">
            <h2 class="arabic-heading text-center mb-4" id="database-title">المكتبة الإحصائية</h2>
            
            <div class="database-controls">
                <div class="search-box">
                    <input type="text" id="test-search" placeholder="ابحث عن اختبار إحصائي..."
                           aria-label="بحث في المكتبة الإحصائية">
                    <i class="fas fa-search"></i>
                </div>
                
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">الكل</button>
                    <button class="filter-btn" data-filter="parametric">معلمية</button>
                    <button class="filter-btn" data-filter="nonparametric">غير معلمية</button>
                    <button class="filter-btn" data-filter="regression">انحدار</button>
                    <button class="filter-btn" data-filter="correlation">ارتباط</button>
                </div>
            </div>
            
            <div class="tests-grid" id="tests-grid" role="list" aria-label="قائمة الاختبارات الإحصائية">
                <!-- Tests will be populated dynamically -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6 mb-4">
                    <h5>روابط سريعة</h5>
                    <ul>
                        <li><a href="index.html">الرئيسية</a></li>
                        <li><a href="research-guide.html">الإرشادات</a></li>
                        <li><a href="statistics.html">الإحصاء</a></li>
                        <li><a href="support.html">الدعم</a></li>
                    </ul>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-4">
                    <h5>معلومات التواصل</h5>
                    <p><i class="fas fa-user me-2"></i> محمود محمد عبدالرحيم</p>
                    <p><i class="fas fa-phone me-2"></i> +96894764758</p>
                    <p><i class="fas fa-envelope me-2"></i> matheg2010@gmail.com</p>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-4">
                    <h5>خدماتنا</h5>
                    <ul>
                        <li><a href="statistics.html">التحليل الإحصائي</a></li>
                        <li><a href="research-guide.html">كتابة البحوث</a></li>
                        <li><a href="support.html">الاستشارات</a></li>
                        <li><a href="research-guide.html">المصادر والمراجع</a></li>
                    </ul>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-4">
                    <h5>تابعنا</h5>
                    <div class="social-links">
                        <a href="#" aria-label="تويتر"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="لينكدإن"><i class="fab fa-linkedin"></i></a>
                        <a href="#" aria-label="فيسبوك"><i class="fab fa-facebook"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="text-center pt-3 border-top">
                <p>&copy; 2025 - جميع الحقوق محفوظة لمحمود محمد عبدالرحيم</p>
                <small class="text-muted">تم تطوير النظام بمعايير الأمان الأكاديمية</small>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <div class="modal fade" id="tutorialModal" tabindex="-1" aria-labelledby="tutorialModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title arabic-heading" id="tutorialModalLabel">دليل الاختبار الإحصائي</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
                </div>
                <div class="modal-body" id="tutorialContent">
                    <!-- Tutorial content will be loaded here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Error Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="errorModalLabel">حدث خطأ</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="إغلاق"></button>
                </div>
                <div class="modal-body" id="errorMessage">
                    <!-- Error message will appear here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Our JavaScript modules -->
    <script type="module" src="js/statistics-core.js"></script>
    <script type="module" src="js/data-validator.js"></script>
    <script type="module" src="js/statistical-tests.js"></script>
    <script type="module" src="js/ui-manager.js"></script>
    
    <!-- Web Worker (external file) -->
    <script>
        // Create Web Worker for heavy calculations
        const statsWorker = new Worker('js/stats-worker.js', { type: 'module' });
    </script>
</body>
</html>